<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Data Viewer</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .faculty-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .faculty-header {
            background: #3498db;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #34495e;
            color: white;
        }
        .export-btn {
            background: #27ae60;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .export-btn:hover {
            background: #229954;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Faculty Data Viewer</h1>
        <div class="controls">
            <button class="export-btn" onclick="exportAllToExcel()">Export All to Excel</button>
            <button class="export-btn" onclick="clearAllData()">Clear All Data</button>
        </div>
        <div id="facultyData"></div>
    </div>

    <script>
        function loadFacultyData() {
            const container = document.getElementById('facultyData');
            const keys = Object.keys(localStorage).filter(key => key.startsWith('faculty_'));
            
            if (keys.length === 0) {
                container.innerHTML = '<p>No faculty data found.</p>';
                return;
            }
            
            let html = '';
            keys.forEach(key => {
                const data = JSON.parse(localStorage.getItem(key));
                html += generateFacultyCard(data);
            });
            
            container.innerHTML = html;
        }
        
        function generateFacultyCard(data) {
            let html = `
                <div class="faculty-card">
                    <div class="faculty-header">
                        <h3>${data.faculty.name} (${data.faculty.id})</h3>
                        <p>Email: ${data.faculty.email}</p>
                        <p>Submitted: ${new Date(data.timestamp).toLocaleString()}</p>
                    </div>
            `;
            
            // Group subjects by semester
            const subjectsBySemester = {};
            Object.keys(data.subjects).forEach(key => {
                if (data.subjects[key].allocated) {
                    const semester = key.split('_')[0].replace('sem', '');
                    if (!subjectsBySemester[semester]) {
                        subjectsBySemester[semester] = [];
                    }
                    subjectsBySemester[semester].push({
                        code: key.split('_')[1],
                        ...data.subjects[key]
                    });
                }
            });
            
            Object.keys(subjectsBySemester).sort().forEach(semester => {
                html += `
                    <h4>Semester ${semester}</h4>
                    <table>
                        <tr>
                            <th>Subject Code</th>
                            <th>Allotted Hours</th>
                            <th>Completed Hours</th>
                            <th>Remaining Hours</th>
                            <th>Progress</th>
                        </tr>
                `;
                
                subjectsBySemester[semester].forEach(subject => {
                    const progress = subject.allottedHours > 0 ? 
                        Math.round((subject.completedHours / subject.allottedHours) * 100) : 0;
                    html += `
                        <tr>
                            <td>${subject.code}</td>
                            <td>${subject.allottedHours}</td>
                            <td>${subject.completedHours}</td>
                            <td>${subject.allottedHours - subject.completedHours}</td>
                            <td>${progress}%</td>
                        </tr>
                    `;
                });
                
                html += '</table>';
            });
            
            html += '</div>';
            return html;
        }
        
        function exportAllToExcel() {
            const keys = Object.keys(localStorage).filter(key => key.startsWith('faculty_'));
            const allData = keys.map(key => JSON.parse(localStorage.getItem(key)));
            
            const csvContent = generateCSV(allData);
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `all_faculty_data_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
        
        function generateCSV(allData) {
            let csv = 'Faculty Name,Faculty ID,Email,Semester,Subject Code,Allotted Hours,Completed Hours,Remaining Hours,Progress%\n';
            
            allData.forEach(data => {
                Object.keys(data.subjects).forEach(key => {
                    if (data.subjects[key].allocated) {
                        const semester = key.split('_')[0].replace('sem', '');
                        const code = key.split('_')[1];
                        const subject = data.subjects[key];
                        const progress = subject.allottedHours > 0 ? 
                            Math.round((subject.completedHours / subject.allottedHours) * 100) : 0;
                        
                        csv += `"${data.faculty.name}","${data.faculty.id}","${data.faculty.email}",${semester},"${code}",${subject.allottedHours},${subject.completedHours},${subject.allottedHours - subject.completedHours},${progress}\n`;
                    }
                });
            });
            
            return csv;
        }
        
        function clearAllData() {
            if (confirm('Are you sure you want to clear all faculty data? This cannot be undone.')) {
                const keys = Object.keys(localStorage).filter(key => key.startsWith('faculty_'));
                keys.forEach(key => localStorage.removeItem(key));
                loadFacultyData();
            }
        }
        
        // Load data on page load
        document.addEventListener('DOMContentLoaded', loadFacultyData);
    </script>
</body>
</html>